
Estrutura Sugerida por Etapas

ğŸ“ Etapa 1 â€“ Provisionamento Manual com Dockerfile + docker-compose

lab-zero-trust/
â”œâ”€â”€ etapa1-docker/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ glpi/
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â”œâ”€â”€ backup/
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â””â”€â”€ ansible/
â”‚       â””â”€â”€ Dockerfile

ğŸ“ Etapa 2 â€“ Provisionamento Automatizado com Terraform

lab-zero-trust/
â”œâ”€â”€ etapa2-terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ glpi.tf
â”‚   â”œâ”€â”€ mariadb.tf
â”‚   â”œâ”€â”€ backup.tf
â”‚   â”œâ”€â”€ ansible.tf
â”‚   â””â”€â”€ twingate.tf

ğŸ“ Etapa 3 â€“ ConfiguraÃ§Ã£o e Hardening com Ansible

lab-zero-trust/
â”œâ”€â”€ etapa3-ansible/
â”‚   â”œâ”€â”€ inventory.ini
â”‚   â”œâ”€â”€ playbook.yml
â”‚   â””â”€â”€ roles/
â”‚       â”œâ”€â”€ glpi-hardening/
â”‚       â””â”€â”€ cert-deploy/


âœ… Vantagens PedagÃ³gicas
Etapa	Foco pedagÃ³gico	Ferramenta	BenefÃ­cio
1. Docker manual	VisualizaÃ§Ã£o e base tÃ©cnica	Dockerfile / Compose	Entendimento prÃ¡tico do que serÃ¡ criado
2. Terraform	Infraestrutura como CÃ³digo	Terraform + Docker Provider	AutomatizaÃ§Ã£o e versionamento do provisionamento
3. Ansible	ConfiguraÃ§Ã£o e seguranÃ§a	Ansible + Checkov	AplicaÃ§Ã£o de hardening e prÃ¡ticas seguras

âœ… Etapa 1 concluÃ­da: aqui estÃ¡ o pacote com o provisionamento manual usando Docker Compose + Dockerfiles.

Estrutura do pacote:
etapa1-docker/
â”œâ”€â”€ docker-compose.yml         # Define os serviÃ§os: mariadb, glpi, backup e ansible
â”œâ”€â”€ backup/
â”‚   â””â”€â”€ Dockerfile             # Imagem leve com Alpine Linux
â””â”€â”€ ansible/
    â””â”€â”€ Dockerfile             # Imagem com Python + Ansible + SSH

cd etapa1-docker
docker-compose up -d

O GLPI ficarÃ¡ acessÃ­vel em: http://localhost:8080


âœ… Etapa 2 â€“ Provisionamento com Terraform concluÃ­da!

etapa2-terraform/
â”œâ”€â”€ main.tf          # provider Docker + configuraÃ§Ãµes globais
â”œâ”€â”€ variables.tf     # variÃ¡veis de projeto e token Twingate
â”œâ”€â”€ mariadb.tf       # imagem + container MariaDB
â”œâ”€â”€ glpi.tf          # imagem + container GLPI
â”œâ”€â”€ backup.tf        # imagem + container de backup (Alpine)
â”œâ”€â”€ ansible.tf       # imagem + container Ansible controller
â””â”€â”€ twingate.tf      # (opcional) imagem + container do Twingate Connector

cd etapa2-terraform
terraform init
terraform apply -auto-approve

Isso recriarÃ¡ exatamente os mesmos containers definidos no docker-compose, mas agora como Infraestrutura como CÃ³digo.


âœ… Etapa 3 â€“ ConfiguraÃ§Ã£o e Hardening com Ansible concluÃ­da!

etapa3-ansible/
â”œâ”€â”€ inventory.ini
â”œâ”€â”€ playbook.yml
â””â”€â”€ roles/
    â”œâ”€â”€ glpi-hardening/
    â”‚   â””â”€â”€ tasks/main.yml
    â””â”€â”€ cert-deploy/
        â””â”€â”€ tasks/main.yml

O que faz:
Executa o Checkov antes de aplicar qualquer configuraÃ§Ã£o;
Aplica hardening bÃ¡sico no servidor GLPI;
Gera um certificado autoassinado e configura o Apache com HTTPS.

cd etapa3-ansible
ansible-playbook -i inventory.ini playbook.yml


ğŸ” VisÃ£o ReforÃ§ada do Papel do Zero Trust com Twingate

O Zero Trust, com apoio do Twingate, muda o foco da proteÃ§Ã£o do perÃ­metro para a proteÃ§Ã£o baseada em identidade e contexto, com forte segmentaÃ§Ã£o e visibilidade reduzida.


ğŸ” RevisÃ£o: O Papel do Zero Trust com Twingate nas Etapas
ğŸ“ Etapa 1 â€“ Provisionamento Manual com Docker Compose
Item	DescriÃ§Ã£o
Objetivo	CompreensÃ£o da arquitetura base (GLPI, MariaDB, Backup, Ansible)
Zero Trust	Ainda nÃ£o aplicado diretamente. Essa etapa serve como referÃªncia para mostrar a diferenÃ§a entre ambientes expostos e ambientes protegidos.
ReflexÃ£o de SeguranÃ§a	O GLPI estÃ¡ acessÃ­vel publicamente via localhost:8080. Isso simula um ambiente tradicional, com exposiÃ§Ã£o direta dos serviÃ§os.

Aprendizado: aqui os alunos percebem a fragilidade do modelo baseado em perÃ­metro (acesso irrestrito via rede local ou redirecionamento de portas).

ğŸ“ Etapa 2 â€“ Provisionamento com Terraform
Item	DescriÃ§Ã£o
Objetivo	AutomaÃ§Ã£o do ambiente com Terraform
Zero Trust (parcial)	O Twingate jÃ¡ Ã© introduzido como recurso opcional via twingate.tf. O token pode ser passado como variÃ¡vel.
ConfiguraÃ§Ã£o	O twingate.tf provisiona o Connector, que estabelece um tÃºnel de saÃ­da e se registra com o Control Plane da conta Twingate do laboratÃ³rio.

Aprendizado: Ã© aqui que o aluno vÃª a transiÃ§Ã£o da exposiÃ§Ã£o direta para um modelo de acesso controlado. Mesmo sem o Twingate Client ainda, jÃ¡ se introduz o conceito de segmentaÃ§Ã£o e ausÃªncia de portas abertas (inbound-free).

ğŸ“ Etapa 3 â€“ Ansible + Checkov + IntegraÃ§Ã£o com Twingate
Item	DescriÃ§Ã£o
Objetivo	Aplicar hardening, certificados e validaÃ§Ã£o de seguranÃ§a
Zero Trust (completo)	O laboratÃ³rio pode incluir a instalaÃ§Ã£o do Twingate Client na mÃ¡quina do aluno ou demonstrar a conexÃ£o via identidade gerenciada.
Acesso via Twingate	O aluno testa o acesso ao GLPI via segmentaÃ§Ã£o ZTNA: sÃ³ quem estÃ¡ autenticado e autorizado vÃª o serviÃ§o â€” nem nmap local detecta a porta.

Aprendizado:

Controle baseado em identidade (ex: autenticaÃ§Ã£o com Google Workspace);
VerificaÃ§Ã£o de contexto (ex: dispositivo, paÃ­s, MFA);
Acesso mÃ­nimo necessÃ¡rio: o usuÃ¡rio vÃª apenas o GLPI (nada de banco, backup, etc.).

âœ… ConclusÃ£o DidÃ¡tica
Essa progressÃ£o permite que o participante:

Etapa	ExposiÃ§Ã£o	Acesso	GovernanÃ§a
Etapa 1	Total	Aberto (porta local)	Nenhuma
Etapa 2	Parcial	AutomaÃ§Ã£o com Terraform	RastreÃ¡vel
Etapa 3	Zero	Controlado por identidade + polÃ­tica	Segmentado e auditÃ¡vel


âœ… SituaÃ§Ã£o Atual dos Labs
Etapa	Status	CompatÃ­vel com Twingate?	AÃ§Ãµes Recomendadas
Etapa 1 (Docker Compose)	OK	âœ–ï¸ (sem Zero Trust)	Nenhuma aÃ§Ã£o. Serve como ambiente â€œabertoâ€ para comparaÃ§Ã£o.
Etapa 2 (Terraform)	OK	âœ… Sim, via twingate.tf	Apenas configurar variÃ¡vel com token do conector
Etapa 3 (Ansible)	OK	Complementar	Pode ser usado para hardening e (se quiser) para configurar arquivos de log ou validaÃ§Ã£o de conectividade com o domÃ­nio Twingate


ğŸ› ï¸ InstruÃ§Ãµes para uso do Twingate (Etapa 2)
1. ğŸ” Obter credenciais no Twingate
Acesse https://app.twingate.com e:

Crie uma conta ou use uma existente;

Crie uma Rede (Network);

Dentro dela, crie um Connector (ele te darÃ¡ um token com trÃªs partes);

Opcional: crie um Remote Network chamado Lab ou GLPI.

2. âœï¸ Atualizar variÃ¡vel twingate_connector_token
No arquivo etapa2-terraform/variables.tf, adicione o token real:

variable "twingate_connector_token" {
  description = "Registration token for the Twingate Connector (optional)"
  type        = string
  default     = "eyJhbGciOiJIUzI1...parte2.parte3"
}
âš ï¸ Se vocÃª quiser manter privado, use o terraform.tfvars ou defina via CLI:
terraform apply -var="twingate_connector_token=..."

3. âœ… Confirmar conteÃºdo de twingate.tf
JÃ¡ deve estar assim (e estÃ¡ funcional):

resource "docker_image" "twingate_connector" {
  count = var.twingate_connector_token == "" ? 0 : 1
  name  = "twingate/connector:latest"
}

resource "docker_container" "twingate_connector" {
  count = var.twingate_connector_token == "" ? 0 : 1
  name  = "${var.project_name}-twingate-connector"
  image = docker_image.twingate_connector[0].name

  env = [
    "TWINGATE_ACCESS_TOKEN=${var.twingate_connector_token}"
  ]

  restart = "unless-stopped"
}
4. ğŸŒ Acesso pelo Client Twingate
VocÃª (ou os alunos) precisam:

Instalar o Twingate Client (Windows, Mac, Linux ou mobile);

Fazer login com o e-mail usado na conta Twingate;

Se autorizado, o GLPI aparecerÃ¡ como recurso na interface web ou client;

Ao acessar, vocÃª estarÃ¡ no tÃºnel Zero Trust e verÃ¡ o GLPI â€” mesmo que as portas estejam bloqueadas na rede local.

5. (Opcional) Definir um recurso no Twingate Web
No console do Twingate:

Crie um recurso (ex: glpi.lab) com IP do container ou nome resolvÃ­vel;

Associe esse recurso Ã  Remote Network do conector;

Defina uma policy (grupo de usuÃ¡rios com acesso);

O DNS interno serÃ¡ resolvido via Twingate Client.

ğŸ“ Extras para o Ansible (opcional)
Se quiser tornar isso mais robusto na Etapa 3:

Um script para testar se o conector estÃ¡ ativo (curl https://network.twingate.com)

Hardening extra com firewall no container de GLPI (acesso sÃ³ via tunel)

VerificaÃ§Ã£o via dig ou ping do hostname de recurso



Destaques incluÃ­dos
Pasta ConteÃºdo-chave
etapa1-docker docker-compose.yml + Dockerfiles (glpi, backup, ansible)
etapa2-terraform  main.tf, variables.tf, mariadb.tf, glpi.tf, backup.tf, ansible.tf, twingate.tf (com abspath()), db_data/
etapa3-ansible  inventory.ini (plugin community.docker.docker), playbook.yml (Checkov, hardening, HTTPS, verificaÃ§Ã£o Twingate), roles glpi-hardening e cert-deploy
README.md InstruÃ§Ãµes especÃ­ficas dentro de cada etapa

Lembre-se: na Etapa 3, antes de rodar o playbook, instale a collection Docker atual:

bash
Copiar
Editar
ansible-galaxy collection install community.docker















ğŸ” Fluxo de ExecuÃ§Ã£o Sugerido (DidÃ¡tico e Incremental)
âœ… Etapa 1 â€“ Provisionamento Manual com Docker Compose
Objetivo: Compreender a composiÃ§Ã£o dos serviÃ§os manualmente e testar a integraÃ§Ã£o GLPI + MariaDB + backup.

Comandos:

bash
Copiar
Editar
cd etapa1-docker
docker-compose up -d
O que observar:

Acesso ao GLPI: http://localhost:8080

Banco MariaDB funcionando

Containers independentes e estÃ¡veis

âœ… Opcional: destrua tudo para liberar recursos e testar os prÃ³ximos mÃ©todos:

bash
Copiar
Editar
docker-compose down -v



âœ… Etapa 2 â€“ Provisionamento Automatizado com Terraform
Objetivo: Demonstrar como transformar o provisionamento manual em cÃ³digo (IaC).

PrÃ©-requisitos:

Docker ativo

Terraform instalado

Comandos:

bash
Copiar
Editar
cd etapa2-terraform
terraform init
terraform apply -auto-approve
Extras:

Pode editar o arquivo variables.tf se quiser injetar token do Twingate.

O Terraform criarÃ¡ todos os containers, inclusive o de Ansible apontando para a Etapa 3.

ğŸ”§ Se quiser resetar:

bash
Copiar
Editar
terraform destroy -auto-approve




âœ… Etapa 3 â€“ Hardening e ValidaÃ§Ã£o com Ansible
Objetivo: Aplicar seguranÃ§a no GLPI e validar com Checkov a infraestrutura.

PrÃ©-requisitos:

Containers criados pela Etapa 2 devem estar rodando

Ansible instalado

Collection Docker instalada:

bash
Copiar
Editar
ansible-galaxy collection install community.docker
Comando principal:

bash
Copiar
Editar
cd etapa3-ansible
ansible-playbook -i inventory.ini playbook.yml
O que serÃ¡ feito:

VerificaÃ§Ã£o com Checkov nos arquivos do Terraform

AplicaÃ§Ã£o de hardening no GLPI (ex: desativar root via SSH)

GeraÃ§Ã£o de certificado HTTPS (autoassinado)

VerificaÃ§Ã£o do Twingate Connector




ğŸ“Œ RecomendaÃ§Ãµes Finais
ğŸ”„ VocÃª nÃ£o precisa destruir os containers da Etapa 1 se quiser apenas observar diferenÃ§as manuais Ã— automatizadas.

âœ… SugestÃ£o para ensino: executar todas as etapas sequencialmente e comparar os outputs (tempo, seguranÃ§a, esforÃ§o).

ğŸ§ª Desafio para alunos: modificar parÃ¢metros do Terraform ou dos playbooks para simular cenÃ¡rios com falhas.

Se quiser, posso gerar um fluxograma visual ou incluir esse passo a passo no README.md geral tambÃ©m. Deseja?





README (VisÃ£o Geral do Fluxo)
markdown
Copiar
Editar
# Guia RÃ¡pido â€“ Fluxo de ExecuÃ§Ã£o dos Labs Zero Trust

> Siga as etapas na ordem. As destruiÃ§Ãµes (clean-ups) sÃ£o opcionais, mas ajudam a comparar
> o esforÃ§o manual Ã— automatizado Ã— seguro.

| Ordem | Etapa | Comandos-chave | Objetivo | ObservaÃ§Ãµes |
|-------|-------|---------------|----------|-------------|
| 1 | **Etapa 1 â€“ Docker Compose** | `docker-compose up -d` | Ver serviÃ§os expostos manualmente (GLPI em http://localhost:8080) | Para reset: `docker-compose down -v` |
| 2 | **Etapa 2 â€“ Terraform** | `terraform init`<br>`terraform apply -auto-approve` | Provisionar a mesma infra como cÃ³digo (IaC) | Passe `twingate_connector_token` via CLI ou `terraform.tfvars` |
| 2a | (Opc.) **Destroy** | `terraform destroy -auto-approve` | Comparar tempo de destruiÃ§Ã£o vs. manual | â€” |
| 3 | **Etapa 3 â€“ Ansible + Checkov** | `ansible-playbook -i inventory.ini playbook.yml` | Hardening, HTTPS e validaÃ§Ã£o de seguranÃ§a | Requer `community.docker` collection |
| 4 | **Twingate (ZTNA)** | Cliente Twingate + login | Acesso segmentado (Zero Trust) | Recurso criado no console (ex.: glpi.lab) |

### Passo a passo resumido

```bash
# Etapa 1
cd etapa1-docker
docker-compose up -d

# (Opcional reset)
docker-compose down -v

# Etapa 2
cd ../etapa2-terraform
terraform init
terraform apply -auto-approve \
  -var="twingate_connector_token=SEU_TOKEN_AQUI"

# Etapa 3
cd ../etapa3-ansible
ansible-galaxy collection install community.docker
ansible-playbook -i inventory.ini playbook.yml
O que observar
Etapa 1: GLPI acessÃ­vel publicamente â†’ rede exposta.

Etapa 2: Sem portas de entrada; containers via IaC; Connector Twingate online.

Etapa 3: GLPI reforÃ§ado (hardening + HTTPS); Checkov bloqueia configuraÃ§Ãµes inseguras; Twingate garante acesso mÃ­nimo.

Limpeza final:

bash
Copiar
Editar
cd etapa2-terraform && terraform destroy -auto-approve
cd ../etapa1-docker && docker-compose down -v
perl
Copiar
Editar

Basta copiar o README acima para o arquivo `README.md` principal ou incluÃ­-lo como anexo para os estudantes. O fluxograma em PNG (`fluxograma_labs.png`) pode ser adicionado ao repositÃ³rio ou aos slides do minicurso.

Qualquer ajuste extra ou versÃ£o em PDF, Ã© sÃ³ avisar! â€‹:contentReference[oaicite:0]{index=0}â€‹







Dito por si:
poderia colocar alguma outra prÃ¡tica nesse contexto que seria interessante? Como exemplo, tirar o 8080 do GLPI para HTTPS com certificado?


Dito pelo ChatGPT:
Excelente sugestÃ£o! Transformar o acesso ao GLPI de http://localhost:8080 para HTTPS verdadeiro, com certificado vÃ¡lido (mesmo que autoassinado), Ã© uma prÃ¡tica muito relevante no contexto de Zero Trust e hardening de aplicaÃ§Ãµes.

Aqui vÃ£o duas prÃ¡ticas complementares que vocÃª pode incorporar ao laboratÃ³rio:

ğŸ” PrÃ¡tica Adicional 1: Configurar acesso ao GLPI via HTTPS
Objetivo:
Remover a exposiÃ§Ã£o em HTTP (:8080) e servir o GLPI via HTTPS na porta 443, com certificado TLS gerado e instalado automaticamente via Ansible.

Etapas:

âœ… No Dockerfile do GLPI:

Instalar apache2 + openssl

Criar virtual host para :443

âœ… No Role cert-deploy (Ansible):

Gerar certificado autoassinado (com openssl)

Copiar chave + certificado para /etc/ssl/

Ativar o site HTTPS com a2enmod ssl + a2ensite default-ssl

âœ… No playbook.yml:

Task para verificar se a porta 8080 estÃ¡ aberta (e fechar via iptables ou firewall)

Task para garantir que apenas 443 estÃ¡ acessÃ­vel

âœ… ValidaÃ§Ã£o do acesso via navegador:

GLPI deve estar disponÃ­vel em https://localhost (ou IP local)

Ignorar aviso de certificado no navegador se autoassinado

ğŸ” PrÃ¡tica Adicional 2: Auditar e reduzir a superfÃ­cie de ataque com netstat + ufw
Objetivo:
Ensinar o estudante a observar serviÃ§os expostos e aplicar segmentaÃ§Ã£o no nÃ­vel de rede, como parte de um princÃ­pio Zero Trust.

Etapas:

âœ… Rodar netstat -tuln no container GLPI

âœ… Criar uma role Ansible chamada glpi-firewall

Usar ufw para permitir apenas 443/tcp

Bloquear 22, 80, 3306, etc.

âœ… Mostrar impacto ao tentar escanear a rede com nmap

âœ¨ Ganhos DidÃ¡ticos:
PrÃ¡tica Habilidade Desenvolvida Relacionamento com Zero Trust
HTTPS no GLPI CriaÃ§Ã£o e uso de certificados, seguranÃ§a de transporte  SeguranÃ§a de dados em trÃ¢nsito, evitar sniffing
Firewall (UFW)  Controle de trÃ¡fego por porta e protocolo ReduÃ§Ã£o da superfÃ­cie de ataque
Remover HTTP  ValidaÃ§Ã£o de hardening  Elimina vias alternativas de acesso nÃ£o autorizado
Certificados via Ansible  AutomaÃ§Ã£o de TLS/SSL  ConfianÃ§a revalidada com cÃ³digo

ğŸ“ Estrutura sugerida para os roles
arduino
Copiar
Editar
etapa3-ansible/
â””â”€â”€ roles/
    â”œâ”€â”€ cert-deploy/
    â”‚   â””â”€â”€ tasks/
    â”‚       â””â”€â”€ main.yml  # GeraÃ§Ã£o do certificado, configuraÃ§Ã£o do Apache
    â””â”€â”€ glpi-firewall/
        â””â”€â”€ tasks/
            â””â”€â”€ main.yml  # UFW: permitir 443, negar resto


            âœ… As novas prÃ¡ticas foram adicionadas com sucesso ao laboratÃ³rio da Etapa 3 (Ansible). Agora vocÃª tem:

ğŸ“ etapa3-ansible/roles/

bash
Copiar
Editar
â”œâ”€â”€ cert-deploy/
â”‚   â””â”€â”€ tasks/
â”‚       â””â”€â”€ main.yml       # GeraÃ§Ã£o de certificado SSL e configuraÃ§Ã£o do Apache
â”œâ”€â”€ glpi-firewall/
â”‚   â””â”€â”€ tasks/
â”‚       â””â”€â”€ main.yml       # AplicaÃ§Ã£o de regras UFW para expor apenas HTTPS
ğŸ“˜ O que foi incluÃ­do:
ğŸ” cert-deploy
Instala Apache + OpenSSL

Gera certificado autoassinado via mÃ³dulo openssl_certificate

Habilita HTTPS (443)

Remove Listen 80 do Apache

Reinicia o serviÃ§o

ğŸ”¥ glpi-firewall
Instala ufw

Permite apenas 443/tcp

Bloqueia o restante por padrÃ£o (policy: deny)

ğŸ§ª Como usar no playbook.yml principal:
Adicione as novas roles na seÃ§Ã£o apropriada:

yaml
Copiar
Editar
- name: Aplicar hardening e configurar HTTPS no GLPI
  hosts: lab-zero-trust-glpi
  become: yes
  roles:
    - glpi-hardening
    - cert-deploy
    - glpi-firewall



    âœ… O que este pacote contÃ©m:
1. etapa1-docker/

docker-compose.yml e Dockerfile para GLPI, Backup e Ansible (provisionamento manual)

2. etapa2-terraform/

Arquivos .tf para infraestrutura como cÃ³digo:

glpi.tf, mariadb.tf, backup.tf, ansible.tf, twingate.tf

Uso de abspath() corrigido para caminhos locais

Inclui o diretÃ³rio db_data/ para volume persistente

3. etapa3-ansible/

inventory.ini com host lab-zero-trust-glpi

playbook.yml completo com:

VerificaÃ§Ã£o Checkov

Hardening bÃ¡sico

ConfiguraÃ§Ã£o HTTPS com certificado autoassinado

AplicaÃ§Ã£o de regras de firewall com UFW

Roles:

glpi-hardening/

cert-deploy/

glpi-firewall/

4. README.md em cada etapa

Comandos, objetivos e instruÃ§Ãµes especÃ­ficas

Fluxo de execuÃ§Ã£o claro, para uso por estudantes